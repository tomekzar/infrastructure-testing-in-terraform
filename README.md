# Infrastructure testing in Terraform
The following repository is a showcase how Terraform infrastructure code can be verified using unit and integration tests backed by [Terratest](https://terratest.gruntwork.io).

Both unit and integration test examples are presented in the repository. 
The way unit tests are working is to inspect output generated by the `terraform plan` command.
On the other hand integration one is based on `terraform apply` execution and real resource creation on an AWS account configured in the AWS CLI.

# Prerequisites
The demo code have been tested using the following versions of tools:
- Terraform 1.1.2
- Go 1.17.5

# Installation
The required tools have to be installed along to their corresponding instructions:
- Terraform - https://learn.hashicorp.com/tutorials/terraform/install-cli
- Go - https://go.dev/doc/install

# Before you start
## Go dependencies init
To download all dependencies required for tests run the following command in the `<repository_root>/test` directory:
```shell
go get
```

## Terraform state S3 bucket setup
The example Terraform stack stores its state in a remote S3 bucket. To proceed with Terraform interaction
it has to be created on a given AWS account and its name has to be updated in `<repository_root>/infrastructure/example/providers.tf` file.

## AWS CLI configuration
The other requirement is to have AWS CLI configured in a current terminal session where Terratest tests will be performed.

# Unit test execution
To execute an example unit test run the following command from the `<repository_root>/test` directory:
```shell
go test -v example_infrastructure_unit_test.go
```

# Integration test execution
To execute an example integration test run the following command from the `<repository_root>/test` directory:
```shell
go test -v example_infrastructure_integration_test.go
```
